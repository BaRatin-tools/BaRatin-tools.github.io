<!DOCTYPE html>
<html lang="fr">

  <head>
    
	    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']]                  
    }
  };
</script>



    

    <meta charset="utf-8">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Algorithmes MCMC</title>
<meta name="author" content="" />





<meta name="description" content="">

<meta name="generator" content="Hugo 0.122.0">


<link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>


<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.11.2/css/all.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link href="/css/animate.css" rel="stylesheet">



  <link href="/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">



<link href="/css/custom.css?1713520952" rel="stylesheet">



  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->



<link rel="shortcut icon" href="/img/logo.png" type="image/x-icon" />
<link rel="apple-touch-icon" href="/img/logo.png" />


<link rel="alternate" href="https://baratin-tools.github.io/index.xml" type="application/rss+xml" title="BaRatin - Bayesian Rating Curves">








<meta property="og:locale" content="fr">
<meta property="og:site_name" content="BaRatin - Bayesian Rating Curves">
<meta property="og:title" content="Algorithmes MCMC">
<meta property="og:type" content="website">
<meta property="og:url" content="https://baratin-tools.github.io/fr/doc/topics/mcmc/" />
<meta property="og:description" content="">
<meta property="og:image" content="https://baratin-tools.github.io/img/logo.png">
<meta property="og:image:type" content="image/png">



  <meta property="og:image:width" content="145">
  <meta property="og:image:height" content="145">






<meta name="twitter:card" content="summary">

<meta name="twitter:title" content="Algorithmes MCMC">

<meta name="twitter:image" content="https://baratin-tools.github.io/img/logo.png">

<meta name="twitter:description" content="">


  </head>

  <body>

    <div id="all">

        


        <header class="navbar-affixed-top" data-spy="affix" data-offset-top="62">
    <div class="navbar navbar-default yamm " role="navigation" id="navbar">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="/fr/">
                    
                      <img src="/img/logoWithText.png" alt="Algorithmes MCMC logo" class="hidden-xs hidden-sm" />
                      <img src="/img/logo.png" alt="Algorithmes MCMC logo" class="visible-xs visible-sm" />
                    
                    <span class="sr-only">Algorithmes MCMC - aller √† l&#39;accueil</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">Basculer la Navigation</span>
                        <i class="fas fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  

                  
                  
                  

                  

                  

                  

                  
                  <li class="dropdown ">
                    <a href="/fr">Accueil</a>
                  </li>
                  
                  
                  
                  

                  

                  

                  

                  
                    
                    
                    <li class="dropdown ">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
                        
                        <ul class="dropdown-menu">
                            
                            <li><a href="/fr/doc/baratinage">BaRatinAGE v3</a></li>
                            
                            <li><a href="/fr/doc/topics">Fiches Th√©matiques</a></li>
                            
                            <li><a href="/fr/doc/case">Cas d&#39;√©tude</a></li>
                            
                        </ul>
                        
                    </li>
                  
                  
                  
                  

                  

                  

                  

                  
                  <li class="dropdown ">
                    <a href="/fr/ressources">Ressources</a>
                  </li>
                  
                  
                  
                  

                  

                  

                  

                  
                  <li class="dropdown ">
                    <a href="/fr/blog/">Blog</a>
                  </li>
                  
                  
                  
                  

                  

                  

                  

                  
                  <li class="dropdown ">
                    <a href="/fr/a-propos">A propos</a>
                  </li>
                  
                  
                  
                  

                  

                  

                  

                  
                  <li class="dropdown ">
                    <a href="/fr/index.xml">rss</a>
                  </li>
                  
                  
                  
                  

                  

                  

                  

                  
                  <li class="dropdown ">
                    <a href="/en">üá¨üáß en</a>
                  </li>
                  
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fas fa-search"></i></button>
                </span>
                    </div>
                </form>
            </div>
            
        </div>
    </div>
</header>




        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Algorithmes MCMC</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-10" id="blog-post">

                        <div id="post-content">
                          

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#principe-g√©n√©ral-des-m√©thodes-mcmc" id="toc-principe-g√©n√©ral-des-m√©thodes-mcmc"><span class="toc-section-number">2</span> Principe g√©n√©ral des m√©thodes MCMC</a></li>
<li><a href="#lalgorithme-de-metropolis" id="toc-lalgorithme-de-metropolis"><span class="toc-section-number">3</span> L‚Äôalgorithme de Metropolis</a></li>
<li><a href="#convergence-et-repr√©sentativit√©-des-simulations-mcmc" id="toc-convergence-et-repr√©sentativit√©-des-simulations-mcmc"><span class="toc-section-number">4</span> Convergence et repr√©sentativit√© des simulations MCMC</a></li>
<li><a href="#construire-des-simulateurs-mcmc-efficaces" id="toc-construire-des-simulateurs-mcmc-efficaces"><span class="toc-section-number">5</span> Construire des simulateurs MCMC efficaces</a></li>
<li><a href="#lalgorithme-mcmc-impl√©ment√©-dans-baratin" id="toc-lalgorithme-mcmc-impl√©ment√©-dans-baratin"><span class="toc-section-number">6</span> L‚Äôalgorithme MCMC impl√©ment√© dans BaRatin</a></li>
</ul>
</div>

<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Les TPs propos√©s dans la page <a href="/fr/doc/topics/bayesien">B.A.-BA de l‚Äôinf√©rence Bayesienne</a> avaient la particularit√© de ne consid√©rer qu‚Äôun unique param√®tre inconnu <span class="math inline">\(\theta\)</span>. On peut assez facilement se convaincre que l‚Äôimpl√©mentation d‚Äôune analyse bay√©sienne se complique lorsque le nombre de param√®tres inconnus augmente. Par exemple, si le vecteur <span class="math inline">\(\boldsymbol{\theta}=(\theta_1,\theta_2,\theta_3)\)</span> contient 3 param√®tres inconnus, alors la distribution a posteriori <span class="math inline">\(p(\theta_1,\theta_2,\theta_3|\boldsymbol{y})\)</span> est une distribution tridimensionnelle : on ne peut m√™me plus la repr√©senter graphiquement dans un simple graphique en 2 dimensions.</p>
<p>Pour rem√©dier √† cette difficult√©, on utilise une approche de type Monte Carlo : plut√¥t que de chercher √† repr√©senter graphiquement la distribution a posteriori, on va essayer de simuler un grand nombre de param√®tres depuis cette distribution, puis on utilisera ces simulations pour d√©crire indirectement la distribution a posteriori. Pour y parvenir, on utilise un type de simulateur Monte Carlo particulier, qui fait l‚Äôobjet de cette fiche : les simulateurs de Monte Carlo par Cha√Ænes de Markov (MCMC).</p>
</div>
<div id="principe-g√©n√©ral-des-m√©thodes-mcmc" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Principe g√©n√©ral des m√©thodes MCMC</h1>
<p>Consid√©rons la densit√© a posteriori illustr√©e dans la Figure ci-dessous. Il y a ici 2 param√®tres inconnus <span class="math inline">\(\boldsymbol{\theta}=(\theta_1,\theta_2)\)</span> , et la densit√© <span class="math inline">\(p(\theta_1,\theta_2|\boldsymbol{y})\)</span> est repr√©sent√©e vue de dessus. G√©n√©rer des r√©alisations √† partir de cette distribution peut sembler difficile pour les raisons suivantes :</p>
<ol style="list-style-type: decimal">
<li>La distribution est multidimensionnelle.</li>
<li>La distribution est assez biscornue, et en tout cas ne ressemble √† aucune distribution ¬´ classique ¬ª. Il y a donc peu d‚Äôespoir de trouver un algorithme pr√™t √† l‚Äôemploi sous Excel, R, Python, Matlab, etc.</li>
<li>Pour couronner le tout, rappelons qu‚Äôen pratique, on se contente souvent de calculer la densit√© a posteriori √† une constante de proportionnalit√© pr√®s ‚Äì la Figure ci-dessous n‚Äôest donc que proportionnelle √† la densit√© a posteriori.</li>
</ol>
<img src="mcmcPrinciple.fr.jpg" width="80%">
<p style="text-align: center;color: gray;">
Figure 1. Illustration du principe g√©n√©ral d‚Äôun simulateur MCMC. Un param√®tre candidat est g√©n√©r√© en sautant depuis le param√®tre actuel, le saut √©tant g√©n√©r√© √† partir d‚Äôune distribution de laquelle on sait simuler facilement (typiquement, une loi normale). Ce candidat sera accept√© ou rejet√© en fonction du ¬´ d√©nivel√© ¬ª parcouru, i.e.¬†du ratio entre la nouvelle et l‚Äôancienne valeur de la densit√© a posteriori.
</p>
<p>La mauvaise nouvelle est que sauf cas tr√®s particulier, l‚Äôimmense majorit√© des distributions a posteriori est affect√©e par les trois difficult√©s d√©crites ci-dessus. La bonne nouvelle est qu‚Äôaucune de ces trois difficult√©s n‚Äôest r√©dhibitoire pour un simulateur MCMC ! Ceci explique pourquoi les algorithmes MCMC sont devenus les ins√©parables compagnons de route des Bay√©siens.</p>
<p>Le principe g√©n√©ral d‚Äôun simulateur MCMC est le suivant : puisqu‚Äôil semble impossible de g√©n√©rer directement des r√©alisations depuis une distribution compliqu√©e comme celle repr√©sent√©e en Figure 1, la g√©n√©ration se fera de mani√®re indirecte. Pour cela, un simulateur MCMC va visiter l‚Äôespace des param√®tres par sauts successifs. Ces sauts seront g√©n√©r√©s √† partir d‚Äôune distribution pour laquelle la simulation est ais√©e (typiquement, une distribution gaussienne). Le ¬´ nouveau ¬ª vecteur de param√®tres ainsi g√©n√©r√©, <span class="math inline">\(\boldsymbol{\theta}^{(*)}\)</span>, sera alors accept√© ou rejet√© en fonction du ¬´ d√©nivel√© ¬ª parcouru, ou pour √™tre plus pr√©cis, en fonction du ratio entre la nouvelle et l‚Äôancienne valeur de la densit√© a posteriori. La section suivante d√©taille ce principe g√©n√©ral pour un simulateur MCMC classique connu sous le nom d‚Äôalgorithme de Metropolis.</p>
</div>
<div id="lalgorithme-de-metropolis" class="section level1" number="3">
<h1><span class="header-section-number">3</span> L‚Äôalgorithme de Metropolis</h1>
<p>L‚ÄôAlgorithme ci-dessous d√©crit l‚Äôalgorithme de Metropolis. Etant donn√© le vecteur de param√®tres actuel <span class="math inline">\(\boldsymbol{\theta}^{(i-1)}\)</span>, on g√©n√®re un param√®tre candidat <span class="math inline">\(\boldsymbol{\theta}^{(*)}\)</span> en sautant al√©atoirement depuis le param√®tre actuel <span class="math inline">\(\boldsymbol{\theta}^{(i-1)}\)</span> (√©tape 1.a.). La taille et l‚Äôorientation du saut sont g√©r√©es par la matrice de covariance <span class="math inline">\(\boldsymbol{\Sigma}\)</span>. Il s‚Äôagit √† pr√©sent d‚Äôaccepter ou de rejeter ce candidat. La r√®gle d‚Äôacceptation est √©nonc√©e en 1.c: on accepte tous les sauts vers le haut (<span class="math inline">\(\tau \ge 1\)</span>); les saut vers le bas (<span class="math inline">\(\tau \lt 1\)</span>) seront accept√©s de mani√®re al√©atoire, avec une probabilit√© √©gale √† <span class="math inline">\(\tau\)</span>. Si le candidat est rejet√©, on reste sur la position actuelle <span class="math inline">\((\boldsymbol{\theta}^{(i)}=\boldsymbol{\theta}^{(i-1)})\)</span>. Il est possible de d√©montrer qu‚Äôavec cette r√®gle d‚Äôacceptation, la marche al√©atoire ainsi g√©n√©r√©e est une r√©alisation de la loi a posteriori, pourvu que le nombre de simulations effectu√©es soit assez grand.</p>
<p style="text-align: center;color: gray;">
Algorithme 1: Metropolis. Pour √™tre tout √† fait exact, l‚Äôalgorithme de Metropolis est en fait plus g√©n√©ral que ce qui est d√©crit ci-dessous : on peut remplacer la distribution de saut gaussienne par n‚Äôimporte quelle distribution sym√©trique.
</p>
<div style="border-style: solid;border-width: thin;">
<ol start="0" style="list-style-type: decimal">
<li>Choisir un point de d√©part <span class="math inline">\(\boldsymbol{\theta}^{(0)}\)</span> et une matrice de covariance <span class="math inline">\(\boldsymbol{\Sigma}\)</span>.</li>
<li>R√©p√©ter pour <span class="math inline">\(i=1:N_{sim}\)</span> :
<ol style="list-style-type: lower-alpha">
<li>G√©n√©rer un candidat <span class="math inline">\(\boldsymbol{\theta}^{(*)}\)</span> √† partir d‚Äôune distribution gaussienne centr√©e sur le param√®tre actuel <span class="math inline">\(\boldsymbol{\theta}^{(i-1)}\)</span> et de matrice de covariance <span class="math inline">\(\boldsymbol{\Sigma}\)</span> : <span class="math inline">\(\boldsymbol{\theta}^{(*)} \leftarrow \mathcal{N}(\boldsymbol{\theta}^{(i-1)},\boldsymbol{\Sigma})\)</span></li>
<li>Calculer le ratio entre la nouvelle et l‚Äôancienne valeur de la densit√© a posteriori : <span class="math inline">\(\tau=\frac{p(\boldsymbol{\theta}^{(*)}|\boldsymbol{y})}{p(\boldsymbol{\theta}^{(i-1)}|\boldsymbol{y})}\)</span></li>
<li>Accepter le candidat <span class="math inline">\((\boldsymbol{\theta}^{(i)}=\boldsymbol{\theta}^{(*)})\)</span> avec une probabilit√© √©gale √† <span class="math inline">\(min(\tau;1)\)</span> ; sinon, rejeter le candidat <span class="math inline">\((\boldsymbol{\theta}^{(i)}=\boldsymbol{\theta}^{(i-1)})\)</span></li>
</ol></li>
</ol>
</div>
<p><br></p>
<p>Remarquons que dans l‚ÄôAlgorithme 1, la densit√© a posteriori n‚Äôintervient que dans le calcul du ratio <span class="math inline">\(\tau\)</span>. Ceci explique pourquoi il n‚Äôest pas n√©cessaire de calculer la constante de normalisation : toute constante se simplifiera dans ce ratio, si bien que ne connaitre la densit√© a posteriori qu‚Äô√† une constante multiplicative pr√®s ne pose absolument aucun probl√®me !</p>
<p>Pr√©cisons que le terme ¬´ cha√Æne de Markov ¬ª est utilis√© dans la nomenclature ¬´ MCMC ¬ª en r√©f√©rence √† la propri√©t√© d‚Äôabsence de m√©moire des simulations MCMC : en effet, la simulation √† l‚Äô√©tape <span class="math inline">\(i+1\)</span> (¬´ futur ¬ª) ne d√©pend que des r√©sultats de l‚Äô√©tape <span class="math inline">\(i\)</span> (¬´ pr√©sent ¬ª) et aucunement des simulations ant√©rieures (¬´ pass√© ¬ª). Ce type de processus s‚Äôappelle une cha√Æne de Markov, en hommage au math√©maticien russe Andre√Ø Andre√Øevitch Markov (Image 1) qui en a d√©velopp√© la th√©orie.</p>
<p>Pour finir, et avant de passer √† la pratique, signalons que les m√©thodes MCMC ne sont pas intrins√®quement li√©es √† l‚Äôapproche bay√©sienne : on peut appliquer un simulateur MCMC √† n‚Äôimporte quelle distribution cible.</p>
<p><br></p>
<img src="AAMarkov.jpg" width="40%">
<p style="text-align: center;color: gray;">
Image 1. Andre√Ø Andre√Øevitch Markov (1856 ‚Äì 1922). Source: <a href="https://fr.wikipedia.org/wiki/Andre%C3%AF_Markov_(math%C3%A9maticien)">Wikipedia</a>
</p>
<p><br></p>
<blockquote>
<p><a href="TP_MCMC.fr.zip"><strong>TP 1. Approche bay√©sienne-MCMC, cas discret</strong></a>. Le fichier Excel propose une impl√©mentation de l‚Äôalgorithme de Metropolis pour les donn√©es de d√©passement de la crue estim√©e comme d√©cennale (voir TP1 de la page <a href="/fr/doc/topics/bayesien">inf√©rence Bayesienne</a>).</p>
<ol style="list-style-type: decimal">
<li>Etudiez les lignes des it√©rations 0 et 1 cellule par cellule pour comprendre comment l‚Äôalgorithme est impl√©ment√©, et v√©rifier que cela correspond bien √† l‚ÄôAlgorithme 1.</li>
<li>Tracez les valeurs simul√©es dans un graphique, puis jouez avec la taille du saut (cellule C3) et observez l‚Äôimpact sur les valeurs simul√©es.</li>
<li>R√©alisez un histogramme des valeurs simul√©es (utilisez l‚Äôutilitaire d‚Äôanalyse dans l‚Äôonglet ¬´ Donn√©es ¬ª). Calculez un intervalle de cr√©dibilit√© √† 90%.</li>
<li>Plut√¥t que de parler en termes de probabilit√© de d√©passement, on pr√©f√®re parler en termes de p√©riode de retour. Repr√©sentez la distribution a posteriori de cette p√©riode de retour (remplissez la colonne vide dans la partie ¬´ Extras‚Ä¶ ¬ª), puis calculez un intervalle de cr√©dibilit√© √† 90%. Le coll√®gue ayant estim√© la crue d√©cennale doit-il √™tre renvoy√© ?</li>
</ol>
<p>Note: √† part pour l‚Äôaspect didactique, impl√©menter un simulateur MCMC sous Excel est globalement une tr√®s mauvaise id√©e, qui a toutes les chances de ne pas fonctionner d√®s que les cas d‚Äô√©tude seront un peu plus complexes que ceux trait√©s en TP (temps de calcul, plantages intempestifs d√®s qu‚Äôil y a trop de lignes/colonnes, fiabilit√© des g√©n√©rateurs de nombres al√©atoires incertaine, capacit√©s graphiques tr√®s limit√©es, etc.). Des langages comme R, Python ou Matlab proposent des impl√©mentations de simulateurs MCMC.</p>
</blockquote>
<blockquote>
<p><a href="TP_MCMC.fr.zip"><strong>TP 2. Approche bay√©sienne-MCMC, cas continu</strong></a>. Le fichier Excel est similaire au pr√©c√©dent, et est simplement adapt√© aux dur√©es inter-√©v√©nements √† Sommi√®res (voir TP2 de la page <a href="/fr/doc/topics/bayesien">inf√©rence Bayesienne</a>).</p>
<ol style="list-style-type: decimal">
<li>R√©alisez un histogramme des valeurs simul√©es et calculez un intervalle de cr√©dibilit√© √† 90%.</li>
<li>Pour chaque valeur simul√©e du param√®tre, calculez la fonction de r√©partition associ√©e (remplissez les colonnes vides dans la partie ¬´ Extras‚Ä¶ ¬ª). Repr√©sentez graphiquement l‚Äôensemble de ces fonctions de r√©partition (limitez-vous en fait aux ~100 premi√®res, sinon Excel risque de planter).</li>
<li>Sur la base de ces ¬´ spaghettis ¬ª, quelle est la probabilit√© d‚Äôattendre moins de 10 ans entre deux inondations ? moins de 100 ans ? moins de 1000 ans ?</li>
</ol>
</blockquote>
<blockquote>
<p><a href="TP_MCMC.fr.zip"><strong>TP 3. Approche bay√©sienne-MCMC, r√©gression lin√©aire</strong></a>. Le fichier Excel est encore similaire aux deux pr√©c√©dents, et est simplement adapt√© aux donn√©es de la r√©gression pluie-d√©bit (voir TP5 de la page <a href="/fr/doc/topics/bayesien">inf√©rence Bayesienne</a>). N√©anmoins, il y a une diff√©rence notable : les param√®tres inconnus sont maintenant au nombre de deux (<span class="math inline">\(\theta\)</span>, la pente de la r√©gression, et <span class="math inline">\(\sigma\)</span>, l‚Äô√©cart-type des r√©sidus).</p>
<ol style="list-style-type: decimal">
<li>Etudiez la ligne de l‚Äôit√©ration 1 pour comprendre comment l‚Äôimpl√©mentation a √©t√© adapt√©e au cas de plusieurs param√®tres inconnus.</li>
<li>Tracez les valeurs simul√©es de <span class="math inline">\(\theta\)</span> et <span class="math inline">\(\sigma\)</span> dans deux graphiques s√©par√©s, puis tracez le nuage des points <span class="math inline">\((\theta,\sigma)\)</span> simul√©s. Quelle information peut-on tirer de ce dernier graphique ?</li>
<li>Pour chaque valeur simul√©e de <span class="math inline">\(\theta\)</span>, calculez la droite de r√©gression associ√©e (remplissez les colonnes vides dans la partie ¬´ Extras‚Ä¶Incertitude param√©trique ¬ª). Repr√©sentez graphiquement l‚Äôensemble de ces droites (limitez-vous encore aux ~100 premi√®res), et superposez-y les couples (pluie ; d√©bit) observ√©s.</li>
<li>La repr√©sentation pr√©c√©dente ignore le fait que le mod√®le de r√©gression est entach√© d‚Äôune
erreur <span class="math inline">\(\varepsilon\)</span>, suppos√©e √™tre une r√©alisation d‚Äôun loi normale <span class="math inline">\(\mathcal{N}(0,\sigma)\)</span>. Modifiez les droites de r√©gressions pr√©c√©dentes en y ajoutant, en chaque point, une erreur simul√©e dans une <span class="math inline">\(\mathcal{N}(0,\sigma)\)</span> (remplissez les colonnes vides dans la partie ¬´ Extras‚Ä¶Incertitude totale ¬ª). Repr√©sentez graphiquement l‚Äôensemble des courbes ainsi obtenues (~100 premi√®res).</li>
<li>Superposez les deux graphiques pr√©c√©dents (copiez le graphique de la question 3, et collez-le dans le graphique de la question 4). Commentez.</li>
</ol>
</blockquote>
</div>
<div id="convergence-et-repr√©sentativit√©-des-simulations-mcmc" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Convergence et repr√©sentativit√© des simulations MCMC</h1>
<p>Il convient de prendre quelques pr√©cautions avant d‚Äôutiliser les valeurs simul√©es par MCMC. En particulier, il faut √©valuer la convergence et la repr√©sentativit√© des simulations.</p>
<p>Consid√©rons la Figure 2, qui correspond aux simulations MCMC effectu√©es dans le TP 2 (dur√©es inter-√©v√©nements). Le point de d√©part choisi est <span class="math inline">\(\theta=300\)</span>, ce qui est beaucoup trop grand et correspond √† une densit√© a posteriori proche de z√©ro. En cons√©quence, la marche al√©atoire a besoin d‚Äôun certain nombre d‚Äôit√©rations avant de rejoindre une gamme de valeurs plus faibles (disons 10-100), qui correspond √† la zone o√π la densit√© a posteriori est grande.</p>
<p>Dans ce cas de figure, la premi√®re partie des it√©rations ne peut pas √™tre consid√©r√©e comme issue de la distribution a posteriori : on dit que le simulateur n‚Äôa pas encore converg√©. La solution pour y rem√©dier est simple : on ignore toute la premi√®re partie des simulations, et on utilisera seulement les valeurs simul√©es au-del√† de la 1000e it√©ration par exemple. On parle de ¬´ temps de chauffe ¬ª, ou de mani√®re √©quivalente, on dit qu‚Äôon ¬´ br√ªle ¬ª les 1000 premi√®res it√©rations.</p>
<img src="mcmcConvergence.fr.png" width="50%">
<p style="text-align: center;color: gray;">
Figure 2. Simulations MCMC correspondant au TP 2 avec un point de d√©part mal choisi <span class="math inline">\(\theta=300\)</span>.
</p>
<p>Consid√©rons √† pr√©sent la Figure 3, qui correspond toujours au TP 2. Les trois cha√Ænes ont √©t√© simul√©es avec des tailles de saut diff√©rentes. Dans le premier cas (Figure 3a), la taille des sauts est tr√®s petite, si bien que le param√®tre candidat est tr√®s proche du param√®tre courant, conduisant √† un ratio de Metropolis <span class="math inline">\(\tau\)</span> tr√®s proche de 1. On aura donc tendance √† syst√©matiquement accepter le param√®tre candidat. Il est d‚Äôailleurs possible de calculer le taux d‚Äôacceptation sur l‚Äôensemble des simulations, et on trouve ici environ 97%.</p>
<p>La Figure 3b correspond au cas de figure oppos√© : la taille des sauts est tr√®s grande, si bien que la plupart des param√®tres candidats sont g√©n√©r√©s dans des zones o√π la densit√© a posteriori est quasi nulle. Le ratio de Metropolis <span class="math inline">\(\tau\)</span> est ainsi tr√®s proche de 0, et on aura donc tendance √† syst√©matiquement rejeter le param√®tre candidat : le taux d‚Äôacceptation est ici √©gal √† environ 3%.</p>
<p>Ces deux cas de figure, biens qu‚Äôoppos√©s, conduisent √† la m√™me cons√©quence : le temps n√©cessaire pour visiter convenablement tout l‚Äôespace des param√®tres sera tr√®s long, n√©cessitant des centaines de milliers d‚Äôit√©rations. Il en d√©coule que les estimations faites √† partir d‚Äôun trop petit nombre d‚Äôit√©rations risquent d‚Äô√™tre peu repr√©sentatives. La Figure 3c illustre un cas o√π la taille des sauts a √©t√© bien choisie, conduisant √† un taux d‚Äôacceptation d‚Äôenviron 50%.</p>
<img src="mcmcJump.fr.png" width="100%">
<p style="text-align: center;color: gray;">
Figure 3. Simulations MCMC correspondant au TP 2 avec diff√©rentes valeurs pour la taille du saut (i.e.¬†l‚Äô√©cart-type de la distribution de saut gaussienne) : (a) taille du saut trop petite √©gale √† 1 ; (b) taille du saut trop grande √©gale √† 500 ; (c) taille du saut bien choisie √©gale √† 20.
</p>
<p>Il existe plusieurs bonnes pratiques simples √† appliquer pour √©viter les d√©sagr√©ments d√©crits pr√©c√©demment. La premi√®re est de syst√©matiquement visualiser les simulations : les probl√®mes flagrants comme un point de d√©part tr√®s mal choisi ou une taille de saut totalement inappropri√©e sont facilement d√©tectables √† l‚Äôoeil. On peut √©galement calculer le taux d‚Äôacceptation : des valeurs proches de 0% ou 100% doivent alerter sur un possible probl√®me. Dans BaRatinAGE, on peut visualiser les simulations MCMC dans un onglet d√©di√© du composant ¬´ Courbe de Tarage ¬ª.</p>
<p>Une seconde strat√©gie est de simuler plusieurs cha√Ænes, avec des points de d√©part diff√©rents, et de v√©rifier que les estimations qui en d√©coulent (apr√®s br√ªlage des premi√®res it√©rations) sont similaires. Si ce n‚Äôest pas le cas, il est vraisemblable que le nombre d‚Äôit√©rations est insuffisant et/ou que la taille des sauts n‚Äôest pas appropri√©e. Plus g√©n√©ralement, il existe de nombreuses techniques plus avanc√©es pour √©valuer la convergence et a repr√©sentativit√© des simulations MCMC. A l‚Äôheure actuelle, ces techniques ne sont pas impl√©ment√©es dans BaRatinAGE. Le lecteur int√©ress√© pourra consulter les sources suivantes: le livre de <a href="http://www.stat.columbia.edu/~gelman/book/">Gelman et al., 2013</a> propose une description g√©n√©rale de ces techniques ; l‚Äôarticle de <a href="https://doi.org/10.1016/j.csda.2005.04.018">El Adlouni et al., 2006</a> en propose une revue ; le package R <a href="https://cran.r-project.org/package=coda">coda</a> impl√©mente plusieurs techniques.</p>
</div>
<div id="construire-des-simulateurs-mcmc-efficaces" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Construire des simulateurs MCMC efficaces</h1>
<p>L‚Äôalgorithme de Metropolis est le simulateur MCMC le plus simple, et ses performances sont suffisantes pour des cas de complexit√© faible √† mod√©r√©e. N√©anmoins, de nombreux autres simulateurs ont √©t√© d√©velopp√©s pour faire face √† des cas plus complexes. L‚Äôobjectif de cette section n‚Äôest pas d‚Äôen dresser la liste exhaustive (il en existe une myriade !), mais simplement de donner quelques strat√©gies g√©n√©rales pour am√©liorer l‚Äôefficacit√© des simulateurs MCMC.</p>
<p>Les TPs ainsi que la section pr√©c√©dente ont montr√© que l‚Äôefficacit√© de l‚Äôalgorithme de Metropolis est en grande partie gouvern√©e par la taille des sauts (elle-m√™me gouvern√©e par les √©l√©ments diagonaux
de la matrice <span class="math inline">\(\boldsymbol{\Sigma}\)</span> dans l‚ÄôAlgorithme 1). Dans les cas o√π certains param√®tres sont fortement corr√©l√©s, l‚Äôorientation des sauts est √©galement importante (√©l√©ments hors diagonale de la matrice <span class="math inline">\(\boldsymbol{\Sigma}\)</span>) : il faut autant que possible essayer de sauter dans la direction sugg√©r√©e par la corr√©lation. Au final, on peut dire qu‚Äôun bon r√©glage de la distribution de saut doit conduire cette derni√®re √† ressembler √† la distribution a posteriori, au moins en termes de taille et d‚Äôorientation.</p>
<p>Cette derni√®re phrase peut sembler paradoxale : l‚Äôobjectif d‚Äôun simulateur MCMC est justement d‚Äôexplorer les propri√©t√©s de la distribution a posteriori. Comment peut-on utiliser ces propri√©t√©s inconnues pour r√©gler le simulateur MCMC ? La r√©ponse est de d√©velopper des simulateurs adaptatifs : on modifie les propri√©t√©s de la distribution de saut au fur et √† mesure des it√©rations, en s‚Äôaidant des valeurs g√©n√©r√©es jusque-l√†. Par exemple, on peut modifier la taille des sauts en fonction du taux d‚Äôacceptation calcul√© sur les it√©rations pr√©c√©dentes. Un taux d‚Äôacceptation trop faible sugg√®re que la taille des sauts est trop grande (cf.¬†section pr√©c√©dente) et devrait donc √™tre diminu√©e, et inversement si le taux d‚Äôacceptation est trop grand.</p>
<p>Une autre strat√©gie peut s‚Äôav√©rer tr√®s efficace dans le cas o√π le param√®tre <span class="math inline">\(\boldsymbol{\theta}=(\theta_1,\ldots,\theta_p)\)</span> a une grande dimension (i.e.¬†<span class="math inline">\(p\)</span> est grand). Elle consiste √† effectuer un saut pour une unique composante de <span class="math inline">\(\boldsymbol{\theta}\)</span> √† la fois. Par exemple, √† l‚Äôit√©ration <span class="math inline">\((i-1)\)</span>, on sautera du param√®tre courant <span class="math inline">\(\left(\theta_1^{(i-1)},\theta_2^{(i-1)},\ldots, \theta_p^{(i-1)}\right)\)</span> vers le param√®tre <span class="math inline">\(\left(\theta_1^{(*)},\theta_2^{(i-1)},\ldots, \theta_p^{(i-1)}\right)\)</span> (seule la premi√®re composante saute). Apr√®s acceptation ou rejet, on aura mis √† jour la premi√®re composante du param√®tre, et obtenu <span class="math inline">\(\left(\theta_1^{(i)},\theta_2^{(i-1)},\ldots, \theta_p^{(i-1)}\right)\)</span>. On passera alors √† la seconde composante, en sautant vers <span class="math inline">\(\left(\theta_1^{(i)},\theta_2^{(*)},\ldots, \theta_p^{(i-1)}\right)\)</span>, et en acceptant/rejetant pour obtenir <span class="math inline">\(\left(\theta_1^{(i)},\theta_2^{(i)},\theta_3^{(i-1)},\ldots, \theta_p^{(i-1)}\right)\)</span>, et ainsi de suite jusqu‚Äô√† ce que toutes les composantes soient mises √† jour. L‚Äôint√©r√™t de cette approche est qu‚Äôelle remplace un saut dans un espace de dimension <span class="math inline">\(p\)</span> par <span class="math inline">\(p\)</span> sauts dans un espace de dimension 1. Ces derniers sont plus faciles √† r√©gler, surtout si l‚Äôon utilise une approche adaptative comme d√©crite pr√©c√©demment.</p>
</div>
<div id="lalgorithme-mcmc-impl√©ment√©-dans-baratin" class="section level1" number="6">
<h1><span class="header-section-number">6</span> L‚Äôalgorithme MCMC impl√©ment√© dans BaRatin</h1>
<p>Le simulateur MCMC impl√©ment√© dans BaRatin utilise les deux strat√©gies d√©crites ci-dessus (pour une description compl√®te, voir <a href="https://doi.org/10.1029/2005WR004591">Renard et al., 2006</a>). L‚Äôalgorithme est r√©sum√© ci-dessous.</p>
<p style="text-align: center;color: gray;">
Algorithme 2. Algorithme MCMC impl√©ment√© dans BaRatin.
</p>
<div style="border-style: solid;border-width: thin;">
<ol start="0" style="list-style-type: decimal">
<li>Choisir un point de d√©part <span class="math inline">\(\boldsymbol{\theta}^{(0)}=\left(\theta_1^{(0)},\ldots, \theta_p^{(0)}\right)\)</span> et des variances de saut <span class="math inline">\(\boldsymbol{\nu}^{(0)}=\left(\nu_1,\ldots, \nu_p\right)\)</span>.</li>
<li><span class="math inline">\(k=0\)</span> <span style="color: DarkSeaGreen"> # initialisation du compteur </span></li>
<li>R√©p√©ter pour <span class="math inline">\(i=1:N_{cycles}\)</span> : <span style="color: DarkSeaGreen"> # A l‚Äôissue de chaque cycle on adaptera la variance de saut </span>
<ol style="list-style-type: lower-alpha">
<li>R√©p√©ter pour <span class="math inline">\(j=1:N_{adapt}\)</span> : <span style="color: DarkSeaGreen"> # Boucle sans adaptation des variances de saut </span>
<ol style="list-style-type: lower-roman">
<li><span class="math inline">\(k=k+1\)</span> <span style="color: DarkSeaGreen"> # Incr√©ment du compteur </span></li>
<li>R√©p√©ter pour <span class="math inline">\(d=1:p\)</span> : <span style="color: DarkSeaGreen"> # Boucle sur chaque composante du vecteur <span class="math inline">\(\boldsymbol{\theta}\)</span> </span>
<ul>
<li>G√©n√©rer un candidat <span class="math inline">\(\theta_d^{(*)}\)</span> √† partir d‚Äôune distribution gaussienne de moyenne <span class="math inline">\(\theta_d^{(k-1)}\)</span> et de variance <span class="math inline">\(\nu_d\)</span> ;</li>
<li>Calculer le ratio entre la nouvelle et l‚Äôancienne valeur de la densit√© a posteriori : <span class="math inline">\(\tau=\frac{p \left( \theta_1^{(k)},\ldots,\theta_{d-1}^{(k)},\theta_d^{(*)},\theta_{d+1}^{(k-1)},\ldots,\theta_{p}^{(k-1)} |\boldsymbol{y} \right)}{p \left( \theta_1^{(k)},\ldots,\theta_{d-1}^{(k)},\theta_d^{(k-1)},\theta_{d+1}^{(k-1)},\ldots,\theta_{p}^{(k-1)} |\boldsymbol{y} \right)}\)</span> ;</li>
<li>Accepter le candidat <span class="math inline">\(\left( \theta_d^{(k)}=\theta_d^{(*)} \right)\)</span> avec une probabilit√© √©gale √† <span class="math inline">\(min(\tau;1)\)</span> ; sinon, rejeter le candidat <span class="math inline">\(\left( \theta_d^{(k)}=\theta_d^{(k-1)} \right)\)</span></li>
</ul></li>
</ol></li>
<li>Mise √† jour des variances de saut
<ol style="list-style-type: lower-roman">
<li>R√©p√©ter pour <span class="math inline">\(d=1:p\)</span> : <span style="color: DarkSeaGreen"> # Boucle sur chaque composante du vecteur <span class="math inline">\(\boldsymbol{\theta}\)</span> </span>
<ul>
<li>Calculer le taux d‚Äôacceptation <span class="math inline">\(\alpha_d\)</span> pour la composante <span class="math inline">\(d\)</span> ;</li>
<li>Si <span class="math inline">\(\alpha_d \le \alpha_{min}\)</span> , <span class="math inline">\(\nu_d=\phi^{-}\times\nu_d\)</span> <span style="color: DarkSeaGreen"> # Le taux d‚Äôacceptation est trop faible, donc on diminue la variance de saut </span></li>
<li>Si <span class="math inline">\(\alpha_d \ge \alpha_{max}\)</span> , <span class="math inline">\(\nu_d=\phi^{+}\times\nu_d\)</span> <span style="color: DarkSeaGreen"> # Le taux d‚Äôacceptation est trop grand, donc on augmente la variance de saut </span></li>
<li>Sinon conserver <span class="math inline">\(\nu_d\)</span> <span style="color: DarkSeaGreen"> # Le taux d‚Äôacceptation est entre les bornes souhait√©es <span class="math inline">\([\alpha_{min};\alpha_{max}]\)</span>, on conserve donc la variance de saut </span></li>
</ul></li>
</ol></li>
</ol></li>
</ol>
</div>
<p><br></p>
<p>Dans l‚Äôalgorithme ci-dessus, les valeurs de <span class="math inline">\(N_{cycles}\)</span>, <span class="math inline">\(N_{adapt}\)</span>, <span class="math inline">\(\alpha_{min}\)</span>, <span class="math inline">\(\alpha_{max}\)</span>, <span class="math inline">\(\phi^{-}\)</span> et <span class="math inline">\(\phi^{+}\)</span> peuvent √™tre modifi√©es pour r√©gler les propri√©t√©s de l‚Äô√©chantillonneur MCMC. Les valeurs par d√©faut d√©finies dans BaRatinAGE (<span class="math inline">\(N_{cycles}=100\)</span>, <span class="math inline">\(N_{adapt}=100\)</span>, <span class="math inline">\(\alpha_{min}=0.1\)</span>, <span class="math inline">\(\alpha_{max}=0.5\)</span>, <span class="math inline">\(\phi^{-}=0.9\)</span> et <span class="math inline">\(\phi^{+}=1.1\)</span>) devraient n√©anmoins convenir dans la grande majorit√© des cas.</p>
<p>Pour finir, les simulations brutes issues de l‚Äôalgorithme ci-dessus sont post-trait√©es de la mani√®re suivante :</p>
<ul>
<li>Br√ªlage : on efface une partie des simulations, comme expliqu√© pr√©c√©demment. Dans BaRatinAGE, le facteur de br√ªlage utilis√© par d√©faut est √©gal √† 0.5 (c‚Äôest-√†-dire qu‚Äôon efface la premi√®re moiti√© des simulations) ;</li>
<li>Affinage : sur les simulations restantes, on ne conserve qu‚Äôune valeur toutes les <span class="math inline">\(N_{affinage}\)</span>. Dans BaRatinAGE, la valeur par d√©faut est <span class="math inline">\(N_{affinage}=10\)</span>. La perte d‚Äôinformation qui en r√©sulte est limit√©e car les simulations MCMC brutes sont tr√®s autocorr√©l√©es.</li>
</ul>
<p>Ainsi, avec les valeurs par d√©faut d√©finies dans BaRatinAGE, l‚Äôalgorithme MCMC g√©n√©rera 10 000 simulations, mais apr√®s post-traitement, seules 500 simulations seront conserv√©es, ce qui est largement suffisant dans la plupart des cas et permet de diminuer √† la fois le temps de calcul (pour le calcul des hydrogrammes en particulier) et les volumes de stockage.</p>
</div>


                        </div>                        
                        
  <div class="container">
    
    

    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/analyse-hydraulique/">L&#39;analyse hydraulique</a> 
		

		
		    &nbsp; | &nbsp;
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/controles-hydrauliques/">Contr√¥les hydrauliques</a> 
		

		
		    &nbsp; | &nbsp;
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/jaugeages/">Incertitudes sur les jaugeages</a> 
		

		
		    &nbsp; | &nbsp;
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/courbe-de-tarage/">Equation de la courbe de tarage</a> 
		

		
		    &nbsp; | &nbsp;
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/limni/">Incertitudes dans les limnigrammes</a> 
		

		
		    &nbsp; | &nbsp;
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/modele-stat/">Mod√®le statistique</a> 
		

		
		    &nbsp; | &nbsp;
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/hydrogrammes/">Incertitudes dans les hydrogrammes</a> 
		

		
		    &nbsp; | &nbsp;
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/bayesien/">Le B.A.-BA de l‚Äôinf√©rence Bayesienne</a> 
		

		
		    &nbsp; | &nbsp;
		
    
		
		   <strong> <a href="https://baratin-tools.github.io/fr/doc/topics/mcmc/">Algorithmes MCMC</a> </strong> 

		

		
    
         
  
  </div>
    




                    </div>
                    

                    

                    

                    <div class="col-md-2">

                        
                    
                        
  <div class="container">
  	<h3> Sections </h3>
    
    
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/analyse-hydraulique/">L&#39;analyse hydraulique</a> </br> </br>
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/controles-hydrauliques/">Contr√¥les hydrauliques</a> </br> </br>
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/jaugeages/">Incertitudes sur les jaugeages</a> </br> </br>
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/courbe-de-tarage/">Equation de la courbe de tarage</a> </br> </br>
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/limni/">Incertitudes dans les limnigrammes</a> </br> </br>
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/modele-stat/">Mod√®le statistique</a> </br> </br>
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/hydrogrammes/">Incertitudes dans les hydrogrammes</a> </br> </br>
		
    
		
		    <a href="https://baratin-tools.github.io/fr/doc/topics/bayesien/">Le B.A.-BA de l‚Äôinf√©rence Bayesienne</a> </br> </br>
		
    
		
		<div style="background-color:beige;">
		   <strong> <a href="https://baratin-tools.github.io/fr/doc/topics/mcmc/">Algorithmes MCMC</a> </strong></br>
		</div>
		</br>
		
    
         
  
  </div>
    





                        

                    </div>
                    

                    

                </div>
                

            </div>
            
            
            
        </div>
        

        <footer id="footer">
  <div class="container">
    
  
    <div class="col-xs-3">
    	<p> <strong> BaRatin</strong> - Bayesian Rating Curves </p>
        <p> <strong>Contact</strong>: baratin.dev %at% inrae.fr </p>
    </div>
  
    <div class="col-xs-3">
        <p> <a href="https://github.com/BaRatin-tools"> <img alt="GitHub logo" src="/img/github-mark.svg" width="24" height="24" /> https://github.com/BaRatin-tools </a> </p>
        <p> <a href="https://github.com/BaM-tools"> <img alt="GitHub logo" src="/img/github-mark.svg" width="24" height="24" /> https://github.com/BaM-tools </a> </p>
    </div>
  
    <div class="col-xs-3">
      <p> 
       <a href="https://www.inrae.fr"><img style="max-width:90%;max-height:40px;" src="/img/Logo-INRAE_Transparent.png" alt="INRAE"> </a>
      </p>   
    </div>
    
    <div class="col-xs-3">
      <p> 
       <a href="https://gdh-hydrometrie.org/"><img style="max-width:90%;max-height:76px;" src="/img/Logo-GDH.png" alt="GDH"> </a>
      </p>   
    </div>
      
  </div>
    
</footer>




    </div>
    

    
<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>


<script src="/js/front.js"></script>



  </body>
</html>
